{"backend_state":"init","connection_file":"/projects/f7fa2993-872e-407d-a554-25861b23781f/.local/share/jupyter/runtime/kernel-b0906649-cf96-4f35-908b-c78c1990d42e.json","kernel":"cv_env","kernel_error":"","kernel_state":"idle","kernel_usage":{"cpu":0,"memory":0},"metadata":{"colab":{"collapsed_sections":[],"name":"aicamp_face_recognition.ipynb","provenance":[]},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.12"}},"trust":true,"type":"settings"}
{"cell_type":"code","exec_count":0,"id":"5a8be4","input":"import cv2\nfrom skimage import io\nimport matplotlib.pyplot as plt\n\nfaceCascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')\nurl = \"https://th.bing.com/th/id/OIP.iE65_gGfu_et4ysVCKB6SQHaFc?w=240&h=180&c=7&r=0&o=5&pid=1.7\"\n\npicture = io.imread(url)\ngray = cv2.cvtColor(picture, cv2.COLOR_RGB2GRAY)\n\nplt.axis(\"off\")\nplt.imshow(gray, cmap=\"gray\")\nplt.show()\n\nfaces = faceCascade.detectMultiScale(\n    gray,\n    scaleFactor=2,\n    minNeighbors=1,\n    minSize=(1, 1),\n    flags = cv2.CASCADE_SCALE_IMAGE\n)\n\nfor (x, y, w, h) in faces:\n    cv2.rectangle(picture, (x, y), (x+w, y+h), (0, 255, 0), 2)\n    \nplt.axis(\"off\")\nplt.imshow(picture)\nplt.show()\n\nprint(f\"Found {len(faces)} faces!\")","pos":18,"type":"cell"}
{"cell_type":"code","exec_count":0,"id":"914523","input":"","pos":21,"type":"cell"}
{"cell_type":"code","exec_count":0,"id":"b72521","input":"import cv2\nfrom skimage import io\nimport matplotlib.pyplot as plt\n\nurl = ","pos":16,"type":"cell"}
{"cell_type":"code","exec_count":13,"id":"487bd1","input":"#read the picture from the url and turn it to BGR format\npicture = io.imread(url)\n\n#convert picture to grayscale\ngray = cv2.cvtColor(picture, cv2.COLOR_RGB2GRAY)","metadata":{"id":"rvtpyzf48e_r","vscode":{"languageId":"python"}},"pos":6,"type":"cell"}
{"cell_type":"code","exec_count":17,"id":"1de7ef","input":"import cv2\nfrom skimage import io\nimport matplotlib.pyplot as plt\n\nfaceCascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')\nurl = \"lebron-james.jpg\"\n\npicture = io.imread(url)\ngray = cv2.cvtColor(picture, cv2.COLOR_RGB2GRAY)\n\nplt.axis(\"off\")\nplt.imshow(gray, cmap=\"gray\")\nplt.show()\n\nfaces = faceCascade.detectMultiScale(\n    gray,\n    scaleFactor=1.1,\n    minNeighbors=10,\n    minSize=(30, 30),\n    flags = cv2.CASCADE_SCALE_IMAGE\n)\n\nfor (x, y, w, h) in faces:\n    cv2.rectangle(picture, (x, y), (x+w, y+h), (0, 255, 0), 2)\n    \nplt.axis(\"off\")\nplt.imshow(picture)\nplt.show()\n\nprint(f\"Found {len(faces)} faces!\")","output":{"0":{"data":{"image/png":"af23173a32698659f30647751334709bfe49eae3","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":17,"metadata":{"needs_background":"light"},"output_type":"execute_result"},"1":{"data":{"image/png":"d0bfd3025182b4e91c6a89e2f8d1bf0f12ad7f59","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":17,"metadata":{"needs_background":"light"},"output_type":"execute_result"},"2":{"name":"stdout","output_type":"stream","text":"Found 1 faces!\n"}},"pos":17,"type":"cell"}
{"cell_type":"code","exec_count":18,"id":"08694d","input":"plt.axis(\"off\")\nplt.imshow(picture)\nplt.show()","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":248},"id":"Dr_8wri_5Y_z","outputId":"03a9bca6-f0f9-4208-963f-e2aca56329ad","vscode":{"languageId":"python"}},"output":{"0":{"data":{"image/png":"11eec0f94032208031329194677440cfbd4a5dfa","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":18,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":8,"type":"cell"}
{"cell_type":"code","exec_count":19,"id":"08cfe6","input":"plt.axis(\"off\")\nplt.imshow(gray, cmap=\"gray\")\nplt.show()","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":248},"id":"DiclYgTz5gXN","outputId":"6d26173c-3062-48a6-dadf-2814787c3130","vscode":{"languageId":"python"}},"output":{"0":{"data":{"image/png":"d06ca3a1592be367a0dcb02fdd3da1f0b9cacf06","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":19,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":9,"type":"cell"}
{"cell_type":"code","exec_count":2,"id":"591759","input":"#import dependencies\nimport cv2\nfrom skimage import io\nimport matplotlib.pyplot as plt","metadata":{"id":"MvO5PwWjmXDl","vscode":{"languageId":"python"}},"pos":2,"type":"cell"}
{"cell_type":"code","exec_count":2,"id":"e36f59","input":"#get the cascade classifier from the cv2 filepath\nfaceCascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')\n\n#url of the image\nurl = \"https://image.shutterstock.com/image-photo/young-successful-team-four-business-260nw-289449125.jpg\"","metadata":{"id":"3AeOvLI76slQ","vscode":{"languageId":"python"}},"pos":4,"type":"cell"}
{"cell_type":"code","exec_count":20,"id":"199337","input":"# Detect faces in the image\nfaces = faceCascade.detectMultiScale(\n    gray,\n    scaleFactor=1.1,\n    minNeighbors=5,\n    minSize=(30, 30),\n    flags = cv2.CASCADE_SCALE_IMAGE\n)","metadata":{"id":"qOH1m1Z69J9h","vscode":{"languageId":"python"}},"pos":11,"type":"cell"}
{"cell_type":"code","exec_count":22,"id":"bc793f","input":"#print the number of faces found\nprint(f\"Found {len(faces)} faces!\")\n\n# Draw a rectangle around the faces\nfor (x, y, w, h) in faces:\n    cv2.rectangle(picture, (x, y), (x+w, y+h), (0, 255, 0), 2)\n\n#show the image with the rectangle drawn around it\nplt.axis(\"off\")\nplt.imshow(picture)\nplt.show()","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":265},"id":"Vx2rUAOH9N6p","outputId":"8e0c08b1-d83d-4bfe-bdff-cc4887bc32fb","vscode":{"languageId":"python"}},"output":{"0":{"name":"stdout","output_type":"stream","text":"Found 4 faces!\n"},"1":{"data":{"image/png":"064602e1410ab4bf6c715aa0dd831715b91e5daa","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":22,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":13,"type":"cell"}
{"cell_type":"code","exec_count":25,"id":"9ee987","input":"","output":{"0":{"data":{"image/png":"78bcf09fb1237f9a1d153bf57596e037f33d0ca1","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":25,"metadata":{"needs_background":"light"},"output_type":"execute_result"},"1":{"ename":"KeyboardInterrupt","evalue":"","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","Input \u001b[0;32mIn [25]\u001b[0m, in \u001b[0;36m<cell line: 15>\u001b[0;34m()\u001b[0m\n\u001b[1;32m     12\u001b[0m plt\u001b[38;5;241m.\u001b[39mimshow(gray, cmap\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mgray\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m     13\u001b[0m plt\u001b[38;5;241m.\u001b[39mshow()\n\u001b[0;32m---> 15\u001b[0m faces \u001b[38;5;241m=\u001b[39m \u001b[43mfaceCascade\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mdetectMultiScale\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m     16\u001b[0m \u001b[43m    \u001b[49m\u001b[43mgray\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m     17\u001b[0m \u001b[43m    \u001b[49m\u001b[43mscaleFactor\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;241;43m1.0001\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[1;32m     18\u001b[0m \u001b[43m    \u001b[49m\u001b[43mminNeighbors\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;241;43m1\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[1;32m     19\u001b[0m \u001b[43m    \u001b[49m\u001b[43mminSize\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m(\u001b[49m\u001b[38;5;241;43m1\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m1\u001b[39;49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m     20\u001b[0m \u001b[43m    \u001b[49m\u001b[43mflags\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m \u001b[49m\u001b[43mcv2\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mCASCADE_SCALE_IMAGE\u001b[49m\n\u001b[1;32m     21\u001b[0m \u001b[43m)\u001b[49m\n\u001b[1;32m     23\u001b[0m \u001b[38;5;28;01mfor\u001b[39;00m (x, y, w, h) \u001b[38;5;129;01min\u001b[39;00m faces:\n\u001b[1;32m     24\u001b[0m     cv2\u001b[38;5;241m.\u001b[39mrectangle(picture, (x, y), (x\u001b[38;5;241m+\u001b[39mw, y\u001b[38;5;241m+\u001b[39mh), (\u001b[38;5;241m0\u001b[39m, \u001b[38;5;241m255\u001b[39m, \u001b[38;5;241m0\u001b[39m), \u001b[38;5;241m2\u001b[39m)\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}},"pos":19,"scrolled":true,"type":"cell"}
{"cell_type":"code","exec_count":3,"id":"495503","input":"# Your code here\nurl = \"scientists.jpg\"\npicture = io.imread(url)\nplt.axis(\"off\")\nplt.imshow(picture)\nplt.show()","metadata":{"vscode":{"languageId":"python"}},"output":{"0":{"data":{"image/png":"84999baa81d5f2458f5816bd7b9c61e9b3a62a56","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":3,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":15,"type":"cell"}
{"cell_type":"code","exec_count":46,"id":"94f20f","input":"import cv2\nfrom skimage import io\nimport matplotlib.pyplot as plt\n\nfaceCascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')\nurl = \"selfie.jpg\"\n\npicture = io.imread(url)\ngray = cv2.cvtColor(picture, cv2.COLOR_RGB2GRAY)\n\nplt.axis(\"off\")\nplt.imshow(gray, cmap=\"gray\")\nplt.show()\n\nfaces = faceCascade.detectMultiScale(\n    gray,\n    scaleFactor=1.0001,\n    minNeighbors=100,\n    minSize=(1, 1),\n    flags = cv2.CASCADE_SCALE_IMAGE\n)\n\nfor (x, y, w, h) in faces:\n    cv2.rectangle(picture, (x, y), (x+w, y+h), (0, 255, 0), 2)\n    \nplt.axis(\"off\")\nplt.imshow(picture)\nplt.show()\n\nprint(f\"Found {len(faces)} faces!\")","output":{"0":{"data":{"image/png":"78bcf09fb1237f9a1d153bf57596e037f33d0ca1","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":46,"metadata":{"needs_background":"light"},"output_type":"execute_result"},"1":{"data":{"image/png":"0fcf6b5fff62ebe957d8e42746ff2d46afae382d","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":46,"metadata":{"needs_background":"light"},"output_type":"execute_result"},"2":{"name":"stdout","output_type":"stream","text":"Found 13 faces!\n"}},"pos":20,"type":"cell"}
{"cell_type":"markdown","id":"24cea5","input":"### Display the Results\n\nThe display will first output the length of the list of faces, or the number of faces, to the user. Then, for each of the face coordinates, cv2 will draw a green rectangle around the faces. Finally cv2_imshow function will display the main image with the rectangles drawn on top.\n\n","metadata":{"id":"g6MqDa0P9MVz"},"pos":12,"type":"cell"}
{"cell_type":"markdown","id":"30862b","input":"# Let's Build An AI Face Detector!\n\nIn just a couple, simple lines you will be able to build your very own face detector where you can input a image url and the face detector will draw boxes around the faces before displaying the results of **AI face detection.**\n\n### Theory Behind the Model\nFirst the face detector splits the image into multiple small sections. For each section, it first runs a series of general facial tests. The sections that pass these tests move on to the next, more specific, facial tests and the ones that don't pass are disregarded. On the sections that the face detector is unsure about, it runs more and more tests (a total of 6000) until the face detector can be positive that the section is part of a face. It is like a cascade, or waterfall, of tests which is why the face detector we use is called a cascade classifier.","metadata":{"id":"npPdoLfV6RlL"},"pos":0,"type":"cell"}
{"cell_type":"markdown","id":"3b1371","input":"### Preprocessing the Image\n\nWe first use the io.imread() function to get the image from the url. However, we need to convert it to grayscale format because we are using the OpenCV classifier. The io image originally comes in RGB color. This is the image we will use to display the boxes around the faces. We also need to convert the image to grayscale as the OpenCV model only works on grayscale faces. \n\n","metadata":{"id":"PXRqLJQ58el8"},"pos":5,"type":"cell"}
{"cell_type":"markdown","id":"5e715a","input":"### Detect the Faces\n\nWe execute the detectMultiScale method to detect the faces. \n\n* The first input is the **grayscale image** we want to use for detection. \n\n* **scaleFactor** is used if the image is too large and we make it smaller by a factor of 1.1 as the face detector can only detect faces in a certain range of sizes.\n \n* **minNeighbors** is one of the most important parameters in the model. Remember, the image is first split into many small sections before classification. If minNeighbors is 5, there must be 5 other parts, or sections, of a face around a certain section if that section can be classified as part of a face (because usually one part of the face is surrounded by other parts). If you make minNeighbors larger, than the model will be much more sure about the faces it detects but it might miss some faces. If you make this smaller, the model will detect more faces but it will also make more mistakes. \n\n* **minSize** is the minimum size a face must be in order for it to be viable for detection.  \n\nThe method will output the coordinates of all the faces found.\n\n","metadata":{"id":"FcClRtog9Fpf"},"pos":10,"type":"cell"}
{"cell_type":"markdown","id":"71a882","input":"## Displaying the Image\n\nWe set axis to off to avoid the annoying tickmarks on the x and y axis of a pyplot plot. We then use the pyplot imshow and then show functions to show the image. We also want to view the grayscale version of the image so we do the same thing but set the image color map parameter to gray.\n\n","metadata":{"id":"2wpc7TRomH3O"},"pos":7,"type":"cell"}
{"cell_type":"markdown","id":"8e7333","input":"### Getting the Image and Classifier\n\nHere we will get the face detector from the OpenCV library and store it in the faceCascade library. We then put the image address/url of the image. The example url below is an image of a group of four people. If you want, you can also upload a picture of yourself to google colab and put the filepath instead of the url to run facial detection on images from your own computer. ","metadata":{"id":"6VqccN6i7k3c"},"pos":3,"type":"cell"}
{"cell_type":"markdown","id":"e90ad3","input":"### Dependencies\n\nFirst we will import the dependencies, or libraries, necessary for this project. The dependencies are OpenCV for the face detector, skimage for reading an image from a url, and pyplot for displaying the image in this notebook.","metadata":{"id":"6QPj94nu6zrE"},"pos":1,"type":"cell"}
{"cell_type":"markdown","id":"f506e5","input":"## Try some images of your own.\nThere are some other images in this folder you can experiment with, or you can use your own image to try and detect faces!","pos":14,"type":"cell"}
{"id":0,"time":1660314761419,"type":"user"}
{"last_load":1660314765262,"type":"file"}